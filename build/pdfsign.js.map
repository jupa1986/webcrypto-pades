{"version":3,"sources":["../src/pdfsign.js"],"names":["webcrypto","pdf","root","rootSuccessor","date","password","startRoot","stream","bytes","length","offset","limit","find","array","copyToEnd","offsetForm","offsetAcroForm","annotEntry","findFreeXrefNr","xref","entries","sigEntry","appendAnnot","appendAcroForm","insertIntoArray","endOffsetAcroForm","pages","catalog","catDict","get","contentRef","fetch","xrefEntry","getEntry","num","xrefEntrySuccosser","findSuccessorEntry","startContent","offsetAnnot","startAnnot","append","startSig","start","crypto","Array","round256","join","middle","now","byteRange","end","append2","subtle","digest","sha256Buffer","sha256Hex","prev","findBackwards","startxref","xrefEntries","gen","free","topDict","getRaw","xrefTable","createXrefTableAppend","createTrailer","from1","to1","from2","to2","pad10","updateArray","newSig","removeFromArray","signpdfEmpty","parsePDF","setPDFDocument","PDFDocument","createXrefTable","sortOnKeys","retVal","last","i","parseInt","calcFlow","pad5","count","size","refRoot","refInfo","substring","dict","sorted","key","sort","tempDict","from","to","cutlen","buf","Uint8Array","len","s","substr","pad2","findRootEntry","rootNr","objId","current","currentOffset","currentMin","Number","MAX_SAFE_INTEGER","currentMinIndex","pos","str","upd","stringToUint8Array","ins","strLen","charCodeAt","used","inc","index","indexOf","entry","uint8","needle","search","match","isSigInRoot","acroForm","x","Math","ceil","Date","yyyy","getFullYear","toString","MM","getMonth","dd","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","createOffset","sign","getTimezoneOffset","abs","hours","floor","minutes","pdfRaw","ArrayBuffer","evaluatorOptions","parseStartXRef","parse","_PDFDocument"],"mappings":"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","file":"pdfsign.js","sourcesContent":["/*\n * PDFSign v1.0.0\n * https://github.com/Communication-Systems-Group/pdfsign.js\n *\n * Copyright 2015, Thomas Bocek, University of Zurich\n * Copyright 2018, Juan Carlos Canaza Ayarachi, jccarlos.a@gmail.com\n *\n * Licensed under the MIT license:\n * http://www.opensource.org/licenses/MIT\n */\n\nimport {bufferToHexCodes} from \"pvutils\";\n\nlet PDFDocument;\n\nfunction createXrefTable(xrefEntries) {\n    xrefEntries = sortOnKeys(xrefEntries);\n    var retVal ='xref\\n';\n    var last = -2;\n    for(var i in xrefEntries) {\n        i = parseInt(i);\n        if(typeof xrefEntries[i].offset === 'undefined') { continue; }\n        retVal += calcFlow(i, last, xrefEntries);\n        var offset = xrefEntries[i].offset;\n        retVal += pad10(offset)+' '+pad5(xrefEntries[i].gen)+' '+(xrefEntries[i].free?'f':'n')+' \\n';\n        last = i;\n    }\n    return retVal;\n}\n\nfunction calcFlow(i, last, xrefEntries) {\n    if(last + 1 === i) {return '';}\n    var count = 1;\n    while(typeof xrefEntries[(i+count)] !== 'undefined'\n          && typeof xrefEntries[(i+count)].offset !== 'undefined') {count ++;}\n    return i + ' '+count+'\\n';\n}\n\nfunction createTrailer(topDict, startxref, sha256Hex, size, prev) {\n    var retVal ='trailer <<\\n';\n    retVal +='  /Size '+(size)+'\\n';\n    var refRoot = topDict.getRaw('Root');\n    if(typeof refRoot !== 'undefined') {\n        retVal +='  /Root '+refRoot.num+' '+refRoot.gen+' R\\n';\n    }\n    var refInfo = topDict.getRaw('Info');\n    if(typeof refInfo !== 'undefined') {\n        retVal +='  /Info '+refInfo.num+' '+refInfo.gen+' R\\n';\n    }\n    retVal +='  /ID [<'+sha256Hex.substring(0,32)+'><'+sha256Hex.substring(32,64)+'>]\\n';\n    if(typeof prev !== 'undefined' ) {\n        retVal +='  /Prev '+prev+'\\n';\n    }\n    retVal +='>>\\n';\n    retVal +='startxref\\n';\n    retVal +=startxref + '\\n';\n    retVal +='%%EOF\\n';\n    return retVal;\n}\n\nfunction createXrefTableAppend(xrefEntries) {\n    xrefEntries = sortOnKeys(xrefEntries);\n\n    var retVal ='xref\\n';\n    var last = -2;\n    for(var i in xrefEntries) {\n        i = parseInt(i);\n        if(typeof xrefEntries[i].offset === 'undefined') { continue; }\n        retVal += calcFlow(i, last, xrefEntries);\n        var offset = xrefEntries[i].offset;\n        retVal += pad10(offset)+' '+pad5(xrefEntries[i].gen)+' '+(xrefEntries[i].free?'f':'n')+' \\n';\n        last = i;\n    }\n    return retVal;\n}\n\n//http://stackoverflow.com/questions/10946880/sort-a-dictionary-or-whatever-key-value-data-structure-in-js-on-word-number-ke\nfunction sortOnKeys(dict) {\n    var sorted = [];\n    for(var key in dict) {\n        sorted[sorted.length] = key;\n    }\n    sorted.sort();\n\n    var tempDict = {};\n    for(var i = 0; i < sorted.length; i++) {\n        tempDict[sorted[i]] = dict[sorted[i]];\n    }\n\n    return tempDict;\n}\n\nexport function removeFromArray(array, from, to) {\n    var cutlen = to - from;\n    var buf = new Uint8Array(array.length - cutlen);\n\n    for (var i = 0; i < from; i++) {\n\t\tbuf[i] = array[i];\n    }\n    for (var i = to, len = array.length; i < len; i++) {\n\t\tbuf[i-cutlen] = array[i];\n    }\n    return buf;\n}\n\nfunction pad10(num) {\n\tvar s = \"000000000\" + num;\n\treturn s.substr(s.length-10);\n}\n\nfunction pad5(num) {\n\tvar s = \"0000\" + num;\n\treturn s.substr(s.length-5);\n}\n\nfunction pad2(num) {\n\tvar s = \"0\" + num;\n\treturn s.substr(s.length-2);\n}\n\nfunction findRootEntry(xref) {\n    var rootNr = xref.root.objId.substring(0, xref.root.objId.length - 1);\n    return xref.entries[rootNr];\n}\n\nfunction findSuccessorEntry(xrefEntries, current) {\n    //find it first\n    var currentOffset = current.offset;\n    var currentMin = Number.MAX_SAFE_INTEGER;\n    var currentMinIndex = -1;\n    for(var i in xrefEntries) {\n        if(xrefEntries[i].offset > currentOffset) {\n            if(xrefEntries[i].offset < currentMin) {\n                currentMin = xrefEntries[i].offset;\n                currentMinIndex = i;\n                break;\n            }\n        }\n    }\n    if(currentMinIndex === -1) {\n        return current;\n    }\n    return xrefEntries[currentMinIndex];\n}\n\nexport function updateArray(array, pos, str) {\n    var upd = stringToUint8Array(str);\n    for (var i = 0, len=upd.length; i < len; i++) {\n        array[i+pos] = upd[i];\n    }\n    return array;\n}\n\nfunction copyToEnd(array, from, to) {\n    var buf = new Uint8Array(array.length + (to - from));\n    for (var i = 0, len=array.length; i < len; i++) {\n        buf[i] = array[i];\n    }\n\n    for (var i = 0, len=(to - from); i < len; i++) {\n        buf[array.length + i] = array[from + i];\n    }\n    return buf;\n}\n\nfunction insertIntoArray(array, pos, str) {\n    var ins = stringToUint8Array(str);\n    var buf = new Uint8Array(array.length + ins.length);\n    for (var i = 0; i < pos; i++) {\n        buf[i] = array[i];\n    }\n    for (var i = 0; i < ins.length; i++) {\n\t\tbuf[pos+i] = ins[i];\n    }\n    for (var i = pos; i < array.length; i++) {\n\t\tbuf[ins.length+i] = array[i];\n    }\n    return buf;\n}\n\nfunction stringToUint8Array(str) {\n    var buf = new Uint8Array(str.length);\n    for (var i=0, strLen=str.length; i<strLen; i++) {\n        buf[i] = str.charCodeAt(i);\n    }\n    return buf;\n}\n\nfunction findFreeXrefNr(xrefEntries, used) {\n    used = typeof used !== 'undefined' ?  used : [];\n    var inc = used.length;\n\n    for (var i=1;i<xrefEntries.length;i++) {\n\n        var index = used.indexOf(i);\n        var entry = xrefEntries[\"\"+i];\n        if(index === -1 && (typeof entry === 'undefined' || entry.free)) {\n            return i;\n\t    }\n        if(index !== -1) {\n            inc--;\n        }\n\t}\n    return xrefEntries.length + inc;\n}\n\nfunction find(uint8, needle, start, limit) {\n    start = typeof start !== 'undefined' ? start : 0;\n    limit = typeof limit !== 'undefined' ? limit : Number.MAX_SAFE_INTEGER;\n\n    var search = stringToUint8Array(needle);\n    var match = 0;\n\n    for(var i=start;i<uint8.length && i<limit;i++) {\n        if(uint8[i] === search[match]) {\n            match++;\n        } else {\n            match = 0;\n            if(uint8[i] === search[match]) {\n                match++;\n            }\n        }\n\n        if(match === search.length) {\n            return (i + 1) - match;\n        }\n    }\n    return -1;\n}\n\nfunction findBackwards(uint8, needle, start, limit) {\n    start = typeof start !== 'undefined' ? start : uint8.length;\n    limit = typeof limit !== 'undefined' ? limit : Number.MAX_SAFE_INTEGER;\n\n    var search = stringToUint8Array(needle);\n    var match = search.length - 1;\n\n    for(var i=start;i>=0 && i<limit;i--) {\n        if(uint8[i] === search[match]) {\n            match--;\n        } else {\n            match = search.length - 1;\n            if(uint8[i] === search[match]) {\n                match--;\n            }\n        }\n\n        if(match === 0) {\n            return i - 1;\n        }\n    }\n    return -1;\n}\n\nfunction isSigInRoot(pdf) {\n    if (typeof pdf.acroForm === 'undefined') {\n        return false;\n    }\n    return pdf.acroForm.get('SigFlags') === 3;\n}\n\nfunction round256(x) {\n    return (Math.ceil(x/256)*256) - 1;\n}\n/**\n * (D:YYYYMMDDHHmmSSOHH'mm)\n * e.g. (D:20151210164400+01'00')\n * where:\n * YYYY shall be the year\n * MM shall be the month (01–12)\n * DD shall be the day (01–31)\n * HH shall be the hour (00–23)\n * mm shall be the minute (00–59)\n * SS shall be the second (00–59)\n * O shall be the relationship of local time to Universal Time (UT), and shall be denoted by one of the characters PLUS SIGN (U+002B) (+), HYPHEN-MINUS (U+002D) (-), or LATIN CAPITAL LETTER Z (U+005A) (Z) (see below)\n * HH followed by APOSTROPHE (U+0027) (') shall be the absolute value of the offset from UT in hours (00–23)\n * mm shall be the absolute value of the offset from UT in minutes (00–59)\n */\nfunction now(date) {\n    date = typeof date !== 'undefined' ? date : new Date();\n    var yyyy = date.getFullYear().toString();\n    var MM = pad2(date.getMonth() + 1);\n    var dd = pad2(date.getDate());\n    var hh = pad2(date.getHours());\n    var mm = pad2(date.getMinutes());\n    var ss = pad2(date.getSeconds());\n    return yyyy + MM + dd+  hh + mm + ss + createOffset(date);\n}\n\nfunction createOffset(date) {\n    var sign = (date.getTimezoneOffset() > 0) ? \"-\" : \"+\";\n    var offset = Math.abs(date.getTimezoneOffset());\n    var hours = pad2(Math.floor(offset / 60));\n    var minutes = pad2(offset % 60);\n    return sign + hours + \"'\" + minutes;\n}\n\nasync function newSig(webcrypto, pdf, root, rootSuccessor, date, password) {\n    //copy root and the entry with contents to the end\n    var startRoot = pdf.stream.bytes.length + 1;\n\n    var limit;\n    if (root.offset == rootSuccessor.offset)\n        limit = find(pdf.stream.bytes, 'endobj', root.offset) + 6;\n    else\n        limit = rootSuccessor.offset;\n\n    var array = copyToEnd(pdf.stream.bytes, root.offset - 1, limit);\n\n    //since we signed the first one, we know how the pdf has to look like:\n    var offsetForm = find(array, '<<', startRoot) +2;\n\n    var offsetAcroForm = find(array, '/AcroForm<</Fields', startRoot);\n\n    var annotEntry = findFreeXrefNr(pdf.xref.entries);\n    var sigEntry = findFreeXrefNr(pdf.xref.entries, [annotEntry]);\n\n    var appendAnnot = ' ' + annotEntry + ' 0 R';\n\n    if (offsetAcroForm < 0) {\n        var appendAcroForm = '/AcroForm<</Fields['+annotEntry+' 0 R] /SigFlags 3>>';\n        array = insertIntoArray(array, offsetForm, appendAcroForm);\n    } else {\n        var endOffsetAcroForm = find(array, ']', offsetAcroForm);\n        array = insertIntoArray(array, endOffsetAcroForm, appendAnnot);\n    }\n\n\n    //we need to add Annots [x y R] to the /Type /Page section. We can do that by searching /Annots\n    var pages = pdf.catalog.catDict.get('Pages');\n    //get first page, we have hidden sig, so don't bother\n    var contentRef = pages.get('Kids')[0]; // pages.get('Kids').length - 1\n    var xref = pdf.xref.fetch(contentRef);\n    // var offsetAnnotEnd = xref.get('#Annots_offset');\n    //we now search ], this is safe as we signed it previously\n    // var endOffsetAnnot = find(array, ']', offsetAnnotEnd);\n    var xrefEntry = pdf.xref.getEntry(contentRef.num);\n    var xrefEntrySuccosser = findSuccessorEntry(pdf.xref.entries, xrefEntry);\n    // var offsetAnnotRelative = endOffsetAnnot - xrefEntrySuccosser.offset;\n\n    var startContent = array.length;\n    array = copyToEnd(array, xrefEntry.offset, xrefEntrySuccosser.offset);\n    // Find /Annots\n    var offsetAnnot = find(array, '/Annots', startContent);\n\n    if (offsetAnnot < 0) {\n        offsetAnnot = find(array, '<<', startContent) + 2;\n        appendAnnot = '/Annots['+appendAnnot+']\\n ';\n    } else {\n        offsetAnnot = find(array, ']', offsetAnnot); // TODO\n    }\n\n    array = insertIntoArray(array, offsetAnnot, appendAnnot);\n\n    var startAnnot = array.length;\n    var append = annotEntry + ' 0 obj\\n<</F 132/Type/Annot/Subtype/Widget/Rect[0 0 0 0]/FT/Sig/DR<<>>/T(signature'+annotEntry+')/V '+sigEntry+' 0 R>>\\nendobj\\n\\n';\n    array = insertIntoArray(array, startAnnot, append);\n\n    var startSig = array.length;\n    var start = sigEntry+ ' 0 obj\\n<</Contents <';\n    //TODO: Adobe thinks its important to have the right size, no idea why this is the case\n    var crypto = new Array(round256(1024 * 6)).join( '0' );\n    var middle = '>\\n/Type/Sig/SubFilter/adbe.pkcs7.detached/Location()/M(D:'+now(date)+'\\')\\n/ByteRange ';\n    var byteRange = '[0000000000 0000000000 0000000000 0000000000]';\n    var end = '/Filter/Adobe.PPKLite/Reason()/ContactInfo()>>\\nendobj\\n\\n';\n    //all together\n    var append2 = start+crypto+middle+byteRange+end;\n    array = insertIntoArray(array, startSig, append2);\n\n    let sha256Buffer = await webcrypto.subtle.digest('SHA-256', array);\n    let sha256Hex = bufferToHexCodes(sha256Buffer);\n\n    var prev = findBackwards(array, 'startxref', array.length-1);\n    prev = findBackwards(array, 'xref', prev);\n\n    var startxref = array.length;\n    var xrefEntries = [];\n    xrefEntries[0] = {offset:0, gen:65535, free:true};\n    xrefEntries[pdf.xref.topDict.getRaw('Root').num] = {offset:startRoot, gen:0, free:false};\n    xrefEntries[contentRef.num] = {offset:startContent, gen:0, free:false};\n    xrefEntries[annotEntry] = {offset:startAnnot, gen:0, free:false};\n    xrefEntries[sigEntry] = {offset:startSig, gen:0, free:false};\n    var xrefTable = createXrefTableAppend(xrefEntries);\n    xrefTable += createTrailer(pdf.xref.topDict, startxref, sha256Hex, xrefEntries.length, prev);\n    array = insertIntoArray(array, array.length, xrefTable);\n\n    var from1 = 0;\n    var to1 = startSig + start.length;\n    var from2 = to1 + crypto.length;\n    var to2 = (array.length - from2) - 1;\n    var byteRange = '['+pad10(from1)+' '+pad10(to1 - 1) + ' ' +pad10(from2 + 1)+ ' ' + pad10(to2) + ']';\n\n    array = updateArray(array, from2 + middle.length, byteRange);\n\n    return [array, [from1, to1 - 1, from2 +1, to2]];\n}\n\nexport function signpdfEmpty(pdfRaw, crypto){\n    const date = new Date();\n\n    let pdf = parsePDF(pdfRaw);\n    var root = findRootEntry(pdf.xref);\n\n    var rootSuccessor = findSuccessorEntry(pdf.xref.entries, root);\n    return newSig(crypto, pdf, root, rootSuccessor, date);\n}\n\nexport function parsePDF(pdfRaw) {\n    if (pdfRaw instanceof ArrayBuffer)\n        pdfRaw = new Uint8Array(pdfRaw);\n\n    let pdf = new PDFDocument({evaluatorOptions:{}}, pdfRaw);\n    pdf.parseStartXRef();\n    pdf.parse();\n    return pdf;\n}\n\nexport function setPDFDocument(_PDFDocument) {\n    PDFDocument = _PDFDocument;\n}\n"]}